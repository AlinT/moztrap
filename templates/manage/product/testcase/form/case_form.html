{% extends 'manage/product/testcase/base.html' %}

{% load icanhaz permissions %}

{% block content %}
<section class="{% block sectionclass %}{% endblock sectionclass %}">

  {% icanhaz "autocomplete_suggestion" %}
  {% icanhaz "autocomplete_input" %}
  {% icanhaz "autocomplete_no_inputs" %}

  <h2>{% block formtitle %}{% endblock formtitle %}</h2>

  {% block caseversions %}
  {% endblock caseversions %}

  <form method="POST" enctype="multipart/form-data" id="{% block formclasses %}single-case-form{% endblock formclasses %}" class="manage-form case-form">
    {% csrf_token %}
    {{ form.non_field_errors }}

    {% block versioningform %}
    <div class="versioning">
      {% include "forms/_field.html" with field=form.product %}
      {% include "forms/_field.html" with field=form.productversion label="Version" %}
      {% include "forms/_field.html" with field=form.and_later_versions %}
      {% if user|has_perm:"library.manage_suite_cases" %}
      {% include "forms/_field.html" with field=form.initial_suite label="Suite" %}
      {% endif %}
    </div>
    {% endblock versioningform %}

    <div class="versioned">
      {% block versionedform %}
        {% include "forms/_field.html" with field=form.name %}
        {% include "forms/_field.html" with field=form.description %}

        {% include "manage/product/testcase/tag/_tagging.html" with formtype="single" %}
        {% include "manage/product/_attachments.html" with obj=caseversion field=form.add_attachment %}
        {% include "manage/product/testcase/form/_step_form.html" %}
      {% endblock versionedform %}
    </div>

    <div class="form-actions">
      <button type="submit" name="action-save" value="1">save test case</button>
    </div>
  </form>

</section>
{% endblock content %}

{% block extrajs %}
<script>
  $(
      function() {
          $('ol.steplist').formset(
              {
                  prefix: '{{ form.steps_formset.prefix }}',
                  formTemplate: '#empty-step-form > li',
                  formSelector: '.steps-form',
                  deleteLink: '<a class="removefields" href="javascript:void(0)">remove</a>',
                  deleteLinkSelector: '.removefields',
                  addAnimationSpeed: 'normal',
                  removeAnimationSpeed: 'fast',
                  autoAdd: true,
                  alwaysShowExtra: true,
                  deleteOnlyActive: true,
                  insertAbove: true
              });
      });

</script>
{% endblock %}

{% block last %}
<div style="display: none;">
  <ul id="empty-step-form" class="empty-form">
    {% include "manage/product/testcase/form/_step_form_item.html" with form=form.steps_formset.empty_form %}
  </ul>
</div>
{% endblock %}
