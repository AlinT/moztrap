{% load execution staticdata %}

    <article id="result-{{ result.id }}" class="item details {{ result.status|status_class }}{% if open %} open{% endif %}" data-action-url="{% url result result_id=result.id %}">

      <header class="summary">
        <div class="status">
          {% if result.status.PENDING %}
            <button class="start" data-action="start" name="action-start">start</button>
          {% endif %}
          {% if result.status.STARTED %}
            <button class="pass" data-action="finishsucceed" name="action-pass">pass</button>
          {% endif %}
          {% if result.status.PASSED %}
            <span class="passed">Passed</span>
          {% endif %}
          {% if result.status.INVALIDATED %}
            <span class="invalidated">Invalid</span>
          {% endif %}
          {% if result.status.FAILED %}
            <span class="failed">Failed</span>
          {% endif %}
        </div>
        <h3 class="title">{{ case.name }}</h3>
      </header>

      <div>
        {% if result.status.STARTED or result.status.INVALIDATED %}
          <section class="testinvalid details{% if result.status.INVALIDATED %} invalidated open{% endif %}">
            {% if result.status.INVALIDATED %}
              <h4 class="summary">invalid or unclear.</h4>
              <div class="invaliddesc content">
                <h5>description of problem:</h5>
                <p>{{ result.comment }}</p>
              </div>
            {% else %}
              <h4 class="summary">invalid or unclear?</h4>
              <div class="invalidform form content">
                <label>description of problem:</label>
                <textarea name="comment" placeholder="please explain why this test case is invalid."></textarea>
                <div class="form-actions">
                  <button class="invalid" data-action="finishinvalidate">mark as invalid</button>
                </div>
              </div>
            {% endif %}
          </section>
        {% endif %}

        <aside class="files">
          <h4>attached files</h4>
          <ul class="files-list">
            {% for attachment in caseversion.attachments %}
            <li class="file"><a href="{{ attachment.url }}">{{ attachment.description }}</a></li>
            {% endfor %}
          </ul>
        </aside>

        <ol class="steps">
          {% for step in caseversion.steps %}
          <li>
            <div class="step">
              <p class="instruction">{{ step.instruction }}</p>
              <p class="outcome">{{ step.expectedResult }}</p>
            </div>
            {% if result.status.STARTED %}
              <div class="stepfail details">
                <p class="summary">fail</p>
                <div class="failform form fail-detail">
                  <input type="hidden" name="failedStepNumber" value="{{ step.stepNumber }}">
                  <ul>
                    <li class="fail-desc">
                      <label for="{{ step.id }}-actualResult">actual result:</label>
                      <textarea name="actualResult" id="{{ step.id }}-actualResult" placeholder="please explain the actual results of this step."></textarea>
                    </li>
                    {# @@@ if previously associated bugs #}
                    <li class="fail-bugs">
                      <p>assign a bug to this result:</p>
                      <ul class="radio-bugs">
                        <li class="bug">
                          <input type="radio" name="bugs" value="1" id="bug-{{ result.id }}-{{ step.id }}-1" />
                          <label for="bug-{{ result.id }}-{{ step.id }}-1">bug option 1</label>
                        </li>
                        <li class="bug">
                          <input type="radio" name="bugs" value="2" id="bug-{{ result.id }}-{{ step.id }}-2" />
                          <label for="bug-{{ result.id }}-{{ step.id }}-2">bug option 2</label>
                        </li>
                        <li class="bug">
                          {# @@@ selecting/deselecting this one toggles the disabled tag on #related_bug #}
                          <input type="radio" name="bugs" value="3" id="bug-{{ result.id }}-{{ step.id }}-new" class="newbug" />
                          <label for="bug-{{ result.id }}-{{ step.id }}-new" class="newbug">assign a new bug</label>
                        </li>
                      </ul>
                    </li>
                    {# @@@ end if #}
                    <li class="fail-bug-new">
                      <label for="related_bug-{{ result.id }}-{{ step.id }}">assign a new bug</label>
                      {# @@@ disabled by default when previously associated bugs #}
                      <input type="url" name="related_bug" value="" id="related_bug-{{ result.id }}-{{ step.id }}" placeholder="optional URL of related bug" disabled>
                    </li>
                  </ul>
                  <div class="form-actions">
                    <button class="fail" data-action="finishfail">submit failure</button>
                  </div>
                </div>
              </div>
            {% endif %}
            {% if result.status.FAILED and result.failedStepNumber == step.stepNumber %}
              <div class="stepfail details failed open">
                <p class="summary">failed</p>
                <div class="faildesc fail-detail">
                  <p>{{ result.actualResult }}</p>
                  {# @@@ wireframed #}
                  {# if bugurl #}
                    <p class="bugurl"><a href="#">http://www.attached-bug-url.com</a></p>
                  {# endif #}
                </div>
              </div>
            {% endif %}
          </li>
          {% endfor %}
        </ol>
      </div>
    </article>
