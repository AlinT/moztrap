{% extends 'results/testrun/base.html' %}

{% load sort staticdata %}

{% block listcontent %}

<section id="runresults">
  <h2>Test Run Results</h2>

  {% include "includes/filter.html" %}

  <form method="POST">
    {% csrf_token %}

    <div class="managelist">
      <nav class="listordering">
        <h3 class="navhead">List Ordering</h3>
        <ul>
          <li class="bystatus">
            <a href="{{ request|sort_url:"status" }}" class="{{ request|sort_status:"status" }}">status</a>
          </li>
          <li class="bycompletion">
            <a href="#">%</a> {# @@@ should be sortable #}
          </li>
          <li class="bytitle">
            <a href="{{ request|sort_url:"name" }}" class="{{ request|sort_status:"name" }}">name</a>
          </li>
          <li class="bycycle">
            <a href="{{ request|sort_url:"testCycle" }}" class="{{ request|sort_status:"testCycle" }}">test cycle</a>
          </li>
          <li class="byproduct">
            <a href="{{ request|sort_url:"product" }}" class="{{ request|sort_status:"product" }}">product</a>
          </li>
        </ul>
      </nav>
      {% for run in runs %}
      <article id="run-id-{{ run.id }}" class="details item {{ run.status|status_class }}">
        <header class="summary">
          <p class="status">
            <span class="{{ run.status|status_class }}">{{ run.status|lower }}</span>
          </p>
          <p class="completion" data-perc="75">75%</p> {# @@@ faked #}
          <h3 class="title">{{ run.name }}</h3>
          <p class="cycle">{{ run.testCycle.name }}</p>
          <p class="product">{{ run.product.name }}</p>
          {% with run.resultsummary as results %}
          <ul class="results">
            <li class="pass">{{ results.PASSED }} <span>passed</span></li>
            <li class="invalid">{{ results.INVALIDATED }} <span>invalid</span></li>
            <li class="fail">{{ results.FAILED }} <span>failed</span></li>
            <li class="pending">{{ results.PENDING|add:results.STARTED }} <span>pending</span></li>
          </ul>
          {% endwith %}
        </header>
        <div class="content">
          <p class="id">#{{ run.id }}</p>
          <p class="drill">
            See related <a href="#{# @@@ #}" title="test suites related to {{ run.name }}">test suites</a>
            or <a href="#{# @@@ #}" title="test cases related to {{ run.name }}">test cases</a>.
          </p>
          {% if run.startDate or run.endDate %}
            <div class="time">
              {% if run.startDate %}
                <p class="start">start date: <time>{{ run.startDate|date }}</time></p>
              {% endif %}
              {% if run.endDate %}
                <p class="end">end date: <time>{{ run.endDate|date }}</time></p>
              {% endif %}
            </div>
          {% endif %}
          <section class="environments">
            {% include "lists/_environments.html" with environments=run.environmentgroups.environments %}
          </section>
          {% if run.team|length %}
            <section class="testers">
              <h4>testers</h4>
              <ul>
                {% for tester in run.team %}
                <li>{{ tester.screenName }}</li>
                {% endfor %}
              </ul>
            </section>
          {% endif %}
        </div>
      </article>
      {% endfor %}
    </div>

    {% include "lists/_listnav.html" %}

  </form>
</section>
{% endblock listcontent %}
